/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var A=Object.defineProperty;var B=Object.getOwnPropertyDescriptor;var H=Object.getOwnPropertyNames;var P=Object.prototype.hasOwnProperty;var O=(l,t)=>{for(var i in t)A(l,i,{get:t[i],enumerable:!0})},R=(l,t,i,e)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of H(t))!P.call(l,n)&&n!==i&&A(l,n,{get:()=>t[n],enumerable:!(e=B(t,n))||e.enumerable});return l};var z=l=>R(A({},"__esModule",{value:!0}),l);var q={};O(q,{default:()=>T});module.exports=z(q);var V=require("obsidian");var w=require("obsidian");var $=require("obsidian"),y=class extends $.AbstractInputSuggest{modal;inputEl;constructor(t,i,e){super(t,i),this.modal=e,this.inputEl=i}async getSuggestions(t){if(this.modal.isUrl(t))return[];let i=t.trim();if(!this.modal.isWiki)return this.getFiles(i);if(i.startsWith("##")){let e=i.slice(2).toLowerCase(),n=this.getAllHeadings();return e?n.filter(s=>s.heading&&s.heading.toLowerCase().includes(e)):n}if(i.startsWith("#^")){let e=i.slice(2).toLowerCase(),n=this.app.workspace.getActiveFile();return n?await this.getAllBlocksInFile(n,e):[]}if(i.startsWith("#")&&!i.startsWith("##")){let e=i.slice(1).toLowerCase(),n=this.getHeadingsInCurrentFile();return e?n.filter(s=>s.heading&&s.heading.toLowerCase().includes(e)):n}if(i.startsWith("^")){let e=i.slice(1).toLowerCase(),n=this.app.workspace.getActiveFile();return n?await this.getAllBlocksInFile(n,e):[]}if(i.includes("#^")){let[e,n=""]=i.split("#^"),s=this.findFile(e);return s?await this.getAllBlocksInFile(s,n):[]}if(i.includes("#")&&!i.startsWith("#")){let[e,n=""]=i.split("#");return this.getHeadingsInFile(e,n)}if(i.includes("^")&&!i.startsWith("^")){let[e,n=""]=i.split("^"),s=this.findFile(e);return s?await this.getAllBlocksInFile(s,n):[]}return this.getFiles(i)}getFiles(t){let i=this.app.vault.getFiles(),e=t.toLowerCase(),n=i.filter(s=>s.path.toLowerCase().includes(e)||s.basename.toLowerCase().includes(e));return n.sort((s,o)=>o.stat.mtime-s.stat.mtime),n.slice(0,20).map(s=>({type:"file",file:s,basename:s.basename,path:s.path,name:s.name,extension:s.extension}))}getHeadingsInCurrentFile(){let t=this.app.workspace.getActiveFile();if(!t)return[];let i=this.app.metadataCache.getFileCache(t);return!i||!i.headings?[]:i.headings.map(e=>({type:"heading",heading:e.heading,level:e.level,file:t}))}getAllHeadings(){let t=this.app.vault.getMarkdownFiles(),i=[];for(let e of t){let n=this.app.metadataCache.getFileCache(e);n&&n.headings&&n.headings.forEach(s=>{i.push({type:"heading",heading:s.heading,level:s.level,file:e})})}return i.slice(0,50)}getHeadingsInFile(t,i=""){let e=this.app.vault.getFiles(),n=t.toLowerCase(),s=e.find(u=>u.basename.toLowerCase()===n||u.path.toLowerCase().includes(n));if(!s)return[];let o=this.app.metadataCache.getFileCache(s);if(!o||!o.headings)return[];let a=i.toLowerCase();return o.headings.filter(u=>!i||u.heading.toLowerCase().includes(a)).map(u=>({type:"heading",heading:u.heading,level:u.level,file:s}))}findFile(t){let i=this.app.vault.getFiles(),e=t.toLowerCase();return i.find(n=>n.basename.toLowerCase()===e||n.path.toLowerCase().includes(e))}async getAllBlocksInFile(t,i=""){let e=this.app.metadataCache.getFileCache(t);if(!e)return[];let s=(await this.app.vault.cachedRead(t)).split(`
`),o=[];if(e.sections){for(let a of e.sections)if(["paragraph","list","blockquote","code"].includes(a.type)){let u=a.position.start.line,g=a.position.end.line,p=s.slice(u,g+1).join(`
`),v=p.match(/\^([a-zA-Z0-9-]+)\s*$/),f=v?v[1]:null,m=f?p.replace(/\s*\^[a-zA-Z0-9-]+\s*$/,""):p;if(i){let d=i.toLowerCase(),h=f&&f.toLowerCase().includes(d),k=m.toLowerCase().includes(d);if(!h&&!k)continue}o.push({type:"block",blockId:f,blockText:m.trim(),file:t,position:a.position})}}return o}generateBlockId(){return Math.random().toString(36).substr(2,6)}async addBlockIdToFile(t,i,e){let s=(await this.app.vault.read(t)).split(`
`),o=i.end.line;s[o]=s[o].trimEnd()+` ^${e}`,await this.app.vault.modify(t,s.join(`
`))}renderSuggestion(t,i){i.addClass("mod-complex");let e=i.createDiv({cls:"suggestion-content"});if(t.type==="heading"){if(e.createDiv({text:t.heading||"",cls:"suggestion-title"}),i.createDiv({cls:"suggestion-aux"}).createSpan({text:`H${t.level}`,cls:"suggestion-flair"}),t.file){let s=this.inputEl.value.trim(),o=this.app.workspace.getActiveFile();!(s.includes("#")&&!s.startsWith("#")&&!s.startsWith("##"))&&(!o||t.file.path!==o.path)&&e.createDiv({text:t.file.path,cls:"suggestion-note"})}}else if(t.type==="block"){let n=t.blockText||"",s=n.length>100?n.substring(0,100)+"...":n;e.createDiv({text:s,cls:"suggestion-title"}),t.blockId&&e.createDiv({text:`^${t.blockId}`,cls:"suggestion-note"})}else e.createDiv({text:t.basename||"",cls:"suggestion-title"}),e.createDiv({text:t.path||"",cls:"suggestion-note"})}async selectSuggestion(t){let i;if(t.type==="heading"){let e=this.app.workspace.getActiveFile();t.file&&e&&t.file.path===e.path?i=`#${t.heading}`:t.file?i=`${t.file.basename}#${t.heading}`:i=`#${t.heading}`}else if(t.type==="block"){if(!t.blockId){let n=this.generateBlockId();t.file&&t.position&&(await this.addBlockIdToFile(t.file,t.position,n),t.blockId=n)}let e=this.app.workspace.getActiveFile();t.file&&e&&t.file.path===e.path?i=`#^${t.blockId}`:t.file?i=`${t.file.basename}#^${t.blockId}`:i=`#^${t.blockId}`}else t.extension==="md"?i=t.basename||"":i=t.name||"";this.inputEl.value=i,this.modal.handleDestInput(),this.close(),document.activeElement!==this.inputEl&&this.inputEl.focus()}get isSuggestOpen(){let t=document.querySelector(".suggestion-container");return t!==null&&!t.hasClass("is-hidden")}selectCurrentSuggestion(){let t=document.querySelector(".suggestion-item.is-selected");t&&t.click()}};function D(l){if(!l||/^https?:\/\//i.test(l)||l.includes("<")||l.includes(">")||l.includes("(")||l.includes(")"))return!1;let t=l.split("#"),i=t[0];if(i.includes("|")||i.includes("^")||i.includes(":")||i.includes("%%")||i.includes("[[")||i.includes("]]")||i.includes("*")||i.includes('"')||i.includes("?")||i.includes("\\")||i.includes("/"))return!1;if(t.length>1){let e=t.slice(1).join("#");if(e.startsWith("^")){let n=e.slice(1);if(!/^[a-zA-Z0-9-]+$/.test(n))return!1}else if(e.includes("[[")||e.includes("]]")||e.includes("|")||e.includes("%%"))return!1}return!0}function M(l){if(!l)return!1;if(/^https?:\/\//i.test(l))return!0;if(l.startsWith("<<")||l.endsWith(">>"))return!1;if(l.startsWith("<")&&l.endsWith(">")){let t=l.slice(1,-1);return!(t.includes("<")||t.includes(">"))}return!(l.includes(" ")||l.includes("^")&&!l.includes("%5E")&&!l.match(/#\^[a-zA-Z0-9-]*$/))}function S(l){return!l||/^https?:\/\//i.test(l)||l.startsWith("<")&&l.endsWith(">")?l:l.replace(/ /g,"%20").replace(/\^/g,"%5E")}function L(l){if(!l)return l;let t=l;l.startsWith("<")&&l.endsWith(">")&&(t=l.slice(1,-1));try{t=decodeURIComponent(t)}catch{t=t.replace(/%20/g," ").replace(/%5E/gi,"^")}return/^https?:\/\//i.test(t)?null:t}var b=class extends w.Modal{link;onSubmit;shouldSelectText;conversionNotice;isWiki;wasUrl;textInput;destInput;fileSuggest;typeSetting;toggleComponent;applyBtn;warningsContainer;constructor(t,i,e,n,s){super(t),this.link=i,this.onSubmit=e,this.shouldSelectText=n||!1,this.conversionNotice=s||null,this.isWiki=!1,this.wasUrl=!1}onOpen(){let{contentEl:t}=this;t.empty(),t.createEl("h4",{text:"Edit Link"}),this.isUrl(this.link.destination)?this.isWiki=!1:this.isWiki=this.link.isWiki,this.wasUrl=this.isUrl(this.link.destination),new w.Setting(t).setName("Link Text").addText(e=>{this.textInput=e,e.setValue(this.link.text),e.inputEl.style.width="100%"}),new w.Setting(t).setName("Destination").addText(e=>{this.destInput=e,e.setValue(this.link.destination),e.inputEl.style.width="100%",this.fileSuggest=new y(this.app,e.inputEl,this),e.inputEl.addEventListener("input",()=>{this.handleDestInput()})}),this.warningsContainer=t.createDiv({cls:"link-warnings-container"}),this.conversionNotice&&this.warningsContainer.createEl("div",{cls:"link-conversion-notice",text:this.conversionNotice}),this.typeSetting=new w.Setting(t).setName("Link Type").setDesc(this.isWiki?"Wiki Link":"Markdown Link").addToggle(e=>{this.toggleComponent=e,e.setValue(this.isWiki).onChange(n=>{let s=this.destInput.getValue();if(n&&!this.isWiki){let o=L(s);o!==null&&o!==s&&this.destInput.setValue(o)}else if(!n&&this.isWiki){let o=S(s);o!==s&&this.destInput.setValue(o)}this.isWiki=n,this.updateUIState()}),e.toggleEl.setAttribute("tabindex","0"),e.toggleEl.addEventListener("keydown",n=>{if(n.key===" "||n.key==="Spacebar"){n.preventDefault();let s=!e.getValue(),o=this.destInput.getValue();if(s&&!this.isWiki){let a=L(o);a!==null&&a!==o&&this.destInput.setValue(a)}else if(!s&&this.isWiki){let a=S(o);a!==o&&this.destInput.setValue(a)}e.setValue(s),this.isWiki=s,this.updateUIState()}})}),new w.Setting(t).addButton(e=>{this.applyBtn=e,e.setButtonText("Apply").setCta().onClick(()=>this.submit())}),this.modalEl.addEventListener("keydown",e=>{if(e.key==="Tab"){e.preventDefault();let n=this.getFocusableElements(),s=document.activeElement,o=n.indexOf(s);o===-1&&(o=0);let a=!e.shiftKey;s===this.destInput.inputEl&&this.fileSuggest.isSuggestOpen&&this.destInput.getValue().trim().length>0&&this.fileSuggest.selectCurrentSuggestion();let g=(o+(a?1:-1)+n.length)%n.length;n[g].focus();return}if(e.ctrlKey&&(e.key==="n"||e.key==="p")&&document.activeElement===this.destInput.inputEl&&this.fileSuggest.isSuggestOpen){e.preventDefault(),e.stopPropagation();let n=e.key==="n"?"ArrowDown":"ArrowUp",s=document.querySelector(".suggestion-container");s&&s.dispatchEvent(new KeyboardEvent("keydown",{key:n,bubbles:!0,cancelable:!0}));return}if(e.key==="Enter"){if(e.target===this.toggleComponent.toggleEl||this.fileSuggest.isSuggestOpen)return;e.preventDefault(),this.submit();return}if(e.key==="Escape"){if(this.fileSuggest.isSuggestOpen){this.fileSuggest.close();return}this.close()}}),this.updateUIState(),this.setInitialFocus()}getFocusableElements(){return[this.textInput.inputEl,this.destInput.inputEl,this.toggleComponent.toggleEl,this.applyBtn.buttonEl].filter(t=>t&&t.offsetParent!==null)}setInitialFocus(){let t=this.link.text,i=this.link.destination,e=i?i.length:0;!t||t.length===0?this.textInput.inputEl.focus():!i||i.length===0?this.destInput.inputEl.focus():e>500||this.isAlmostUrl(i)?(this.destInput.inputEl.focus(),this.destInput.inputEl.select()):this.shouldSelectText?(this.textInput.inputEl.focus(),this.textInput.inputEl.select()):(this.textInput.inputEl.focus(),t&&t.length>0&&this.textInput.inputEl.select())}isUrl(t){if(!t)return!1;let i=t.trim();return/^https?:\/\/\S+$|^www\.\S+$/i.test(i)}isAlmostUrl(t){if(!t)return!1;let i=t.trim();return/^htp:\/\/|^htps:\/\/|^http:\/[^\/]|^https\/\/|^www\.[a-zA-Z0-9-]+$/i.test(i)}handleDestInput(){let t=this.destInput.getValue(),i=this.isUrl(t);i&&(this.isWiki=!1,this.toggleComponent.setValue(!1)),this.wasUrl=i,this.updateUIState()}updateUIState(){this.typeSetting.setDesc(this.isWiki?"Wiki Link":"Markdown Link"),this.warningsContainer.querySelectorAll(".link-warning").forEach(s=>s.remove()),this.destInput.inputEl.classList.remove("link-warning-highlight"),this.textInput.inputEl.classList.remove("link-warning-highlight");let i=this.destInput.getValue(),e=i?i.length:0,n=[];this.isWiki&&this.isUrl(i)&&n.push({text:"\u26A0\uFE0F Warning: Valid URL detected but Wiki Link format selected. Wiki links cannot link to external URLs.",cls:"link-warning-error"}),i&&!this.isUrl(i)&&(this.isWiki&&!D(i)?S(i)!==i?n.push({text:"\u26A0\uFE0F Invalid WikiLink destination. Can toggle to Markdown below.",cls:"link-warning-caution"}):n.push({text:'\u26A0\uFE0F Invalid Wikilink destination. Contains forbidden characters (| ^ : %% [[ ]] * " ? \\\\ / in filename).',cls:"link-warning-error"}):!this.isWiki&&!M(i)&&(L(i)!==null?n.push({text:"\u26A0\uFE0F Invalid Markdown link destination. Can toggle to Wikilink below.",cls:"link-warning-caution"}):n.push({text:"\u26A0\uFE0F Invalid Markdown destination: Encode spaces and `^`; wrap them in `<...>`; or toggle to WikiLink",cls:"link-warning-error"}))),!this.isUrl(i)&&this.isAlmostUrl(i)&&n.push({text:"\u26A0\uFE0F Warning: Destination looks like a URL but may have typos (check protocol).",cls:"link-warning-caution"}),e>500&&n.push({text:`\u26A0\uFE0F Warning: Destination is very long (${e} chars). Consider shortening for reliability.`,cls:"link-warning-caution"}),n.length>0&&(n.forEach(s=>{this.warningsContainer.createEl("div",{cls:`link-warning ${s.cls}`,text:s.text})}),this.destInput.inputEl.classList.add("link-warning-highlight"))}submit(){let t=this.textInput.getValue().trim(),i=this.destInput.getValue().trim();if(!t||!i){this.warningsContainer.querySelectorAll(".link-validation-error").forEach(s=>s.remove());let n=this.warningsContainer.createEl("div",{cls:"link-warning link-validation-error link-warning-error"});n.createEl("div",{text:"\u26A0\uFE0F Error: Both Link Text and Destination are required."}),n.createEl("div",{text:"Press Escape to cancel and close without making changes.",cls:"link-validation-hint"}),t?i||(this.destInput.inputEl.focus(),this.destInput.inputEl.classList.add("link-warning-highlight")):(this.textInput.inputEl.focus(),this.textInput.inputEl.classList.add("link-warning-highlight"));return}this.onSubmit({text:t,destination:i,isWiki:this.isWiki}),this.close()}onClose(){this.contentEl.empty()}};var W=require("obsidian"),C=class extends W.PluginSettingTab{plugin;constructor(t,i){super(t,i),this.plugin=i}display(){let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"Link Editor Settings"}),new W.Setting(t).setName("Always move cursor to end of link").setDesc("If enabled, the cursor will always move after the link after editing.").addToggle(i=>i.setValue(this.plugin.settings.alwaysMoveToEnd).onChange(async e=>{this.plugin.settings.alwaysMoveToEnd=e,await this.plugin.saveSettings()}))}};var Q={alwaysMoveToEnd:!1},T=class extends V.Plugin{settings;async onload(){await this.loadSettings(),this.addCommand({id:"edit-link",name:"Edit link",editorCallback:async(t,i)=>{let e=t.getCursor(),n=t.getLine(e.line),s=/\[([^\]]+)\]\(([^)]+)\)/g,o=/\[\[([^\]|]+)(?:\|([^\]]+))?\]\]/g,a,u=null,g=0,p=0,v=!0;for(;(a=s.exec(n))!==null;)if(g=a.index,p=a.index+a[0].length,e.ch>=g&&e.ch<=p){u={text:a[1],destination:a[2],isWiki:!1},v=e.ch<=g+1;break}if(!u){for(;(a=o.exec(n))!==null;)if(g=a.index,p=a.index+a[0].length,e.ch>=g&&e.ch<=p){u={destination:a[1],text:a[2]??a[1],isWiki:!0},v=e.ch<=g+2;break}}let f=!1,m=null;if(!u){let d=t.getSelection(),h="";try{h=await navigator.clipboard.readText(),h=h.trim()}catch{}let k=r=>{if(!r)return!1;let c=r.trim();return/^https?:\/\/\S+$|^www\.\S+$/i.test(c)},F=r=>{if(!r)return r;let c=r.trim();return/^https?:\/\//i.test(c)?c:/^www\./i.test(c)?"https://"+c:c},N=k(d),U=k(h),E="",x="",I=!1;if(N){let r=d.trim(),c=F(r);E=r,x=c,I=!0,f=!0,r!==c&&(m=`\u2713 URL converted: ${r} \u2192 ${c}`)}else if(d)if(E=d,U){let r=h,c=F(r);x=c,I=!0,r!==c&&(m=`\u2713 URL converted: ${r} \u2192 ${c}`)}else x=h,I=!1;else if(U){let r=h,c=F(r);E=c,x=c,f=!0,I=!0,r!==c&&(m=`\u2713 URL converted: ${r} \u2192 ${c}`)}else E="",x=h,I=!1;if(u={text:E,destination:x,isWiki:!I},t.somethingSelected()){let r=t.getCursor("from"),c=t.getCursor("to");g=r.ch,p=c.ch}else g=e.ch,p=e.ch}new b(this.app,u,d=>{let h;d.isWiki?d.text===d.destination?h=`[[${d.destination}]]`:h=`[[${d.destination}|${d.text}]]`:h=`[${d.text}](${d.destination})`,t.replaceRange(h,{line:e.line,ch:g},{line:e.line,ch:p});let k;this.settings.alwaysMoveToEnd?k=g+h.length:k=v?g+h.length:g,t.setCursor({line:e.line,ch:k})},f,m).open()}}),this.addSettingTab(new C(this.app,this))}onunload(){}async loadSettings(){this.settings=Object.assign({},Q,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}};
